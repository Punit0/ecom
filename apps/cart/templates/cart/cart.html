{% extends 'core/base.html' %}
{% block carousel %} {% endblock %}

{% block content %}

  

            <!--Main layout-->
            <main class="mt-5 pt-4">
              <div class="container wow fadeIn" id="cartapp">
                
                {% if cart %}

                <!-- Heading -->
                <h2 class="my-5 h2 text-center">Checkout form</h2>

                <!--Grid row-->
                <div class="row">

                  <!--Grid column-->
                  <div class="col-md-8 mb-4">

                    <!--Card-->
                    <div class="card">

                      <!--Card content-->
                      <form class="card-body" @submit.prevent="submitForm"> 

                        <!--Grid row-->
                        <div class="row">

                          <!--Grid column-->
                          <div class="col-md-6 mb-2">

                            <!--firstName-->
                            <div class="md-form ">
                              <input type="text" id="firstName" class="form-control" name="first_name" v-model="first_name">
                              <label for="firstName" class="">First name</label>
                            </div>

                          </div>
                          <!--Grid column-->

                          <!--Grid column-->
                          <div class="col-md-6 mb-2">

                            <!--lastName-->
                            <div class="md-form">
                              <input type="text" id="lastName" class="form-control" name="last_name" v-model="last_name">
                              <label for="lastName" class="">Last name</label>
                            </div>

                          </div>
                          <!--Grid column-->

                        </div>
                        <!--Grid row-->

                        

                        <!--email-->
                        <div class="md-form mb-5">
                          <input type="text" id="email" class="form-control" placeholder="youremail@example.com" name="email" v-model="email">
                          <label for="email" class="">Email</label>
                        </div>

                        <!--address-->
                        <div class="md-form mb-5">
                          <input type="text" id="address" class="form-control" placeholder="Chauraha, Dhangadhi" name="address" v-model="address">
                          <label for="address" class="">Address</label>
                        </div>

                        <!--address-2-->
                        <div class="md-form mb-5">
                          <input type="text" id="address-2" class="form-control" placeholder="Apartment or House number" name="place" v-model="place">
                          <label for="address-2" class="">place</label>
                        </div>

                        <!-- zip-->

                        <div class="md-form mb-5">
                          <label for="zip">Zip</label>
                          <input type="text" class="form-control" id="zip" placeholder="" name="zipcode" v-model="zipcode">
                        </div>
                        

                        <hr>

                       
                        <hr>

                        <!--

                        <div class="d-block my-3">
                          <div class="custom-control custom-radio">
                            <input id="credit" name="paymentMethod" type="radio" class="custom-control-input" checked required>
                            <label class="custom-control-label" for="credit">E sewa</label>
                          </div>
                         
                          <div class="custom-control custom-radio">
                            <input id="paypal" name="paymentMethod" type="radio" class="custom-control-input" required>
                            <label class="custom-control-label" for="paypal">Cash on Delivery</label>
                          </div>
                        </div>
                        
                      -->
                      
                        <hr class="mb-4">
                        <button class="btn btn-primary btn-lg btn-block">Continue to checkout</button>

                      </form>

                    </div>
                    <!--/.Card-->

                  </div>
                  <!--Grid column-->

                  <!--Grid column-->
                  <div class="col-md-4 mb-4">

                    <!-- Heading -->
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                      <span class="text-muted"> <strong>Your Cart</strong></span>
                      <span class="badge badge-secondary badge-pill">[[ numItems ]]</span>
                    </h4>

                    <!-- Cart -->
                    <ul class="list-group mb-3 z-depth-1">

                      <li class="list-group-item d-flex justify-content-between lh-condensed">
                        <div>
                          <h6 class="my-0"> <strong>Product</strong></h6>
                        </div>
                        <span> <strong>Quantity</strong></span>
                        <span> <strong>Price</strong> </span>
                        <span> <strong>Total Price</strong> </span>
                      </li>



                          <li  v-for="product in products" class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                              <h6 class="my-0"> <strong>[[product.title]]</strong></h6>
                            </div>
                            <span>[[product.quantity]]</span>
                            <span>RS.[[product.price]]</span>
                            <span>RS.[[product.total_price]]</span>
                          </li>
                      
                      
                          
                          

                      <li class="list-group-item d-flex justify-content-between">
                        <span> <strong>Total (RS)</strong> </span>
                        <strong>[[ totalCost ]]</strong>
                      </li>
                    </ul>
                    <!-- Cart -->

                    <!-- Promo code -->
                    <form class="card p-2">
                      <div class="input-group">
                        <input type="text" class="form-control" placeholder="Promo code" aria-label="Recipient's username" aria-describedby="basic-addon2">
                        <div class="input-group-append">
                          <button class="btn btn-secondary btn-md waves-effect m-0" type="button">Redeem</button>
                        </div>
                      </div>
                    </form>
                    <!-- Promo code -->

                  </div>
                  <!--Grid column-->

                </div>
                <!--Grid row-->
                {% else %}
                <p>You have no item </p>
                {% endif %}
              </div>
            </main>
            <!--Main layout-->
    

  {% endblock %}

  {% block scripts %}
            <script>
              var cartapp = new Vue({
                el: '#cartapp',
                delimiters: ['[[', ']]'],
                store: store,

                data ()  {

                  return {

                    first_name: '',
                    last_name: '',
                    email: '',
                    address: '',
                    zipcode: '',
                    place: '',
                    products: [{{ productsstring|safe }}]
                    
                  }
                },

                computed: {
                  numItems: function() {
                    return store.state.numItems
                  },

                  totalCost: function(){
                    return store.state.totalCost
                  }
                },

                methods: {

                  submitForm (){

                    var data = {  
                      'first_name': this.first_name,
                      'last_name': this.last_name,
                      'email': this.email,
                      'address': this.address,
                      'zipcode': this.zipcode,
                      'place': this.place,


                    };
                    fetch('/api/checkout/', {

                      method: 'POST',
                      headers: {
                         'Content-Type': 'application/json',
                         'X-CSRFToken': '{{ csrf_token }}'
                      },
                      credentials: 'same-origin',
                      body: JSON.stringify(data)
                    })

                    .then((response) => {

                      console.log('success');
                      window.location.href = '/'

                    })

                    .catch( function (error){
                      console.log(error);

                    })


                  },


                },
              
                


              });



            </script>


  {% endblock %}