{% extends 'core/base.html' %}
{% block carousel %} {% endblock %}
{% block content %} 

  <!--Main layout-->
  <main class="mt-4 pt-4">
    <div class="container dark-grey-text mt-5" >

      <!--Grid row-->
      <div class="row wow fadeIn">

        <!--Grid column-->
        <div class="col-md-6 mb-4">

          <img src="{{ product.image.url }}" class="img-fluid" alt="">

        </div>
        <!--Grid column-->

        <!--Grid column-->
        <div class="col-md-6 mb-4">

          <!--Content-->
          <div class="p-4" id="productapp">

            <div class="mb-3">
              <a href="">
                <span class="badge purple mr-1">{{product.category}}</span>
              </a>
              <a href="">
                <span class="badge blue mr-1"> {{product.tag}} </span>
              </a>
              
            </div>

            <p class="lead">
              <span class="mr-1">
                <del>Rs.{{product.old_price}}</del>
              </span>
              <span>{{product.price}}</span>
            </p>

            <p class="lead font-weight-bold">Description</p>

            <p> {{product.description }} </p>

            <form class="d-flex justify-content-left">
              <!-- Default input -->
              <input type="number" value="1" aria-label="Search" class="form-control" style="width: 100px">
              <button  @click="addToCart({{product.id}})" class="btn btn-primary btn-md my-0 p" type="submit">Add to cart
                <i class="fas fa-shopping-cart ml-1"></i>
              </button>
            
            </form>
            
            

          </div>
          <!--Content-->

        </div>
        <!--Grid column-->

      </div>
      <!--Grid row-->
    </div>
    
  </main>
  <!--Main layout-->



{% endblock %}

{% block scripts %}
<script>

    var productapp = new Vue({
        el: '#productapp',
        delimiters: ['[[',']]'],

        store: store,
        
        data() {
          return {

          }
        },

        mounted (){
            console.log('Mounted');
        },
        methods : {
          addToCart(product_id, quantity, price) {
	        console.log('product_id:', product_id);

	        var data = {
	            'product_id': product_id,
	            'update': true,
				'quantity': parseInt(quantity) + 1
				
	        };
			
			store.commit('increment',1);
			

	       fetch('/api/add_to_cart/', {
	            method: 'POST',
	            headers: {
	                'Content-Type': 'application/json',
	                'X-CSRFToken': '{{ csrf_token }}'
	            },

	            credentials: 'same-origin',
	            body: JSON.stringify(data)
	        })
	            .then((response) => {
					console.log(response)

					for(var i = 0; i<this.products.length; i++)
					{
						var product = this.products[i];
						
						if(product.id == product_id)
						{
							this.products[i].quantity = parseInt(this.products[i].quantity) +1;
							this.products[i].total_price = parseInt(this.products[i].quantity) * parseFloat(this.products[i].price)
						}
					
					}
					

	            })
	            .catch(function (error) {
	                console.log('Error 2');
	                console.log(error);

	            }) 
	    },
        }

    });


</script>
{% endblock %}